### Perforce Helix Core Structured Application Logs

Based on the Perforce server documentation, the **application logs** refer to the structured server logs generated by the P4D server process (Helix Core). These are distinct from the database metadata schema you referenced earlier but complement it by capturing runtime events, commands, errors, and audits. Unlike the human-readable P4LOG file, structured logs are in **CSV format** for easy parsing and analysis (e.g., via `p4 logparse` or ETL tools like those for AlloyDB).

#### Primary Documentation Link
- **Structured Logging Overview**: https://help.perforce.com/helix-core/server-apps/p4sag/current/Content/P4SAG/structure-logging-using.html
  - This page details the format, fields, event types, and configuration. It's the canonical reference, similar to the `/schema/current/` endpoint for metadata.
- **Related: P4LOG Usage**: https://help.perforce.com/helix-core/server-apps/p4sag/current/Content/P4SAG/p4log-using.html (for enabling and basic log file management).
- **Command Reference**: https://help.perforce.com/helix-core/server-apps/cmdref/current/Content/CmdRef/P4LOG.html (environment variable and file location).

For full logs, enable via configurables like `serverlog.file.1` (sets log paths) and `net.log.level` (verbosity). Logs are written to directories like `/opt/perforce/servers/server-instance/logs/` on Linux or `P4ROOT` on Windows. They auto-rotate to prevent bloat.

#### Log Data Model (CSV Schema)
Structured logs are event-based CSVs (e.g., `commands.csv`, `errors.csv`, `audit.csv`, and an aggregated `all.csv`). Each row is an event with **common prefix fields** (always present) followed by **event-specific fields**. The schema is versioned (e.g., pinned via `serverlog.version.N` for backward compatibility).

I've modeled this as a relational-friendly structure: Think of it as a core `events` table with JSONB for variable fields, or separate tables per event type for normalization. Key fields below (types inferred for AlloyDB/Postgres loading: e.g., TIMESTAMP, TEXT, BIGINT).

##### Common Fields (Prefix in Every Row)
These form the base of every log entry.

| Field Name     | Type          | Description | Example |
|----------------|---------------|-------------|---------|
| `f_eventtype` | TEXT (e.g., '0.55') | Event type and protocol version (e.g., '2.53' for CommandEnd in 2021.2). | '6.58' (Audit event, 2024.1 format) |
| `f_timestamp` | BIGINT (epoch secs) | Unix timestamp of event. | 1732147200 |
| `f_timestamp2`| BIGINT (nanos) | Nanoseconds to add for sub-second precision. | 123456789 |
| `f_date`      | TIMESTAMP (ISO8601) | Human-readable date (2024.1+). | '2025-11-20T12:00:00Z' |
| `f_pid`       | BIGINT | Process/thread ID. | 12345 |
| `f_cmdident`  | TEXT | Unique command ID (multi-server consistent, 2020.1+). | 'cmd-abc123' |
| `f_serverid`  | TEXT | Server ID logging the event. | 'server1' |
| `f_cmdno`     | INTEGER | Command sequence on connection. | 42 |
| `f_user`      | TEXT | Executing user. | 'alice' |
| `f_client`    | TEXT | Client workspace/stream. | '//client/ws' |
| `f_func`      | TEXT | Command name. | 'submit' |
| `f_host`      | TEXT | Client IP (may include proxies). | '192.168.1.100' |
| `f_prog`      | TEXT | Client app (e.g., 'p4'). | 'p4v' |
| `f_version`   | TEXT | Client version. | '2025.2' |
| `f_args`      | TEXT | Colon-separated args (encoded, truncated). | 'file1.txt:%file2.txt' |
| `f_cmdgroup`  | TEXT | Command group for bundling (2022.2+). | 'batch-sync' |

##### Event Types and Specific Fields
Events are categorized by type (0-26). Each type adds 0+ suffix fields. For a data model, use a `type` discriminator column and JSONB for extensions.

| Event Type | Name                  | Purpose | Key Specific Fields (Examples) |
|------------|-----------------------|---------|--------------------------------|
| 0         | CommandStart         | Command init. | None (relies on prefix). |
| 1         | ComputeEnd           | Compute phase end (2024.1+). | `f_lapse` (ms), `f_memory` (bytes). |
| 2         | CommandEnd           | Command completion. | `f_lapse` (total ms), `f_reason` (exit code), `f_memory` (peak bytes). |
| 3         | AnyError             | All errors (warnings+). | `f_severity` (level), `f_msg` (error text). |
| 4         | Error                | Non-fatal user errors. | `f_msg`, `f_severity`. |
| 5         | FatalError           | System fatals. | `f_msg`, `f_severity`. |
| 6         | Audit                | User actions (sync/submit). | `f_action` (e.g., 'add'), `f_path` (file), `f_rev` (revision), `f_filesize` (bytes). |
| 7         | PerformanceUsage     | Resource usage. | `f_cpu` (ms), `f_io` (bytes), `f_memory` (bytes). |
| 8         | NetworkPerformance   | Network I/O (2023.2+). | `f_rpc_count`, `f_rpc_errors`, `f_bytes_sent`. |
| 9         | DatabasePerformance  | DB metrics. | `f_table` (e.g., 'db.rev'), `f_locks`, `f_scans`, `f_pages`. |
| 10        | Logappend            | `p4 logappend` events. | Up to `f_arg1`–`f_arg25` (custom args). |
| 11        | Trigger              | Trigger exec. | `f_trigger_name`, `f_status` (success/fail). |
| 12        | ServerEvent          | Lifecycle (start/shutdown). | `f_event` (e.g., 'startup'). |
| 13        | Obliterate           | Purge events. | `f_path`, `f_rev`. |
| 14        | NetworkEstimates     | Transfer estimates. | `f_estimated_bytes`, `f_method`. |
| 15        | Integrity            | Replica checks. | `f_checksum`, `f_missing_files`. |
| 16        | Authentication       | Logins. | `f_method` (e.g., 'ldap'), `f_success` (bool). |
| 17        | NetworkRoute         | Connection paths. | `f_route` (hop list). |
| 18        | AuditSize            | File sizes in audits (deprecated 2019.2). | `f_filesize` (moved to Audit). |
| 19        | LDAPSync             | Sync events. | `f_users_synced`, `f_groups_synced`. |
| 20        | Action               | CRUD on entities. | `f_entity_type` (e.g., 'change'), `f_action` (CRUD). |
| 21        | RemoteDatabasePerformance | Remote depot metrics. | Similar to DB perf, with `f_remote_server`. |
| 22        | ServerLockPerformance| Lock contention. | `f_lock_type`, `f_wait_ms`. |
| 23        | DatabaseBlockingLocksTaken | Failed locks. | `f_table`, `f_lock_key`. |
| 24        | LibrarianUsage       | Archive ops (S3, 2023.2+). | `f_archive_path`, `f_operation` (get/put). |
| 25        | ClientStats          | Client transfers (2023.2+). | `f_bytes_transferred`, `f_speed` (MB/s). |
| 26        | CacheStats           | Proxy cache stats (2023.2+). | `f_cache_hit`, `f_bytes_from_cache`. |

#### Loading into AlloyDB (Similar to Metadata)
- **Single Table?** Possible for prototyping (e.g., `logs` table with `event_type` TEXT, common fields as columns, `specific_fields` JSONB). But normalize for scale: Core `events` table + type-specific tables (e.g., `audit_events`) joined on `cmdident`.
- **ETL Steps**:
  1. Tail/Export: Use `p4 logtail` or file watchers to stream CSVs.
  2. Parse: Python/pandas to read CSVs, map types (e.g., `f_timestamp` → TIMESTAMP via `pd.to_datetime`).
  3. Load: `COPY` for batches; use Dataflow for real-time (e.g., Pub/Sub → Beam → AlloyDB).
  4. Schema DDL Snippet:
     ```sql
     CREATE TABLE perforce.logs (
         event_type TEXT NOT NULL,
         timestamp TIMESTAMP NOT NULL,
         user TEXT,
         func TEXT,
         -- ... other common fields
         specific_data JSONB,  -- For event vars
         ingested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
     );
     PARTITION BY RANGE (timestamp);
     ```
- **Tips**: Rotate logs via `serverlog.max.chunksize`; filter with `p4 logparse` before loading to reduce volume.

This log model enables queries like "average command latency by user" (`SELECT AVG(lapse_ms) FROM logs WHERE event_type LIKE '2.%' GROUP BY user;`). If you need ETL code samples or focus on a specific event type, let me know!
